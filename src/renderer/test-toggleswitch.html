<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToggleSwitch Component Test</title>
    <link rel="stylesheet" href="styles/variables.css" />
    <link rel="stylesheet" href="styles/base.css" />
    <link rel="stylesheet" href="styles/components.css" />
    <style>
      body {
        padding: 40px;
        max-width: 800px;
        margin: 0 auto;
      }

      .test-section {
        margin-bottom: 40px;
        padding: 24px;
        background: var(--color-background-secondary);
        border-radius: var(--radius-lg);
      }

      .test-section h2 {
        margin-top: 0;
        margin-bottom: 16px;
        font-size: var(--font-size-lg);
        color: var(--color-text-primary);
      }

      .test-section p {
        margin-bottom: 16px;
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
      }

      .toggle-row {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 12px;
        padding: 12px;
        background: var(--color-background);
        border-radius: var(--radius-md);
      }

      .toggle-label {
        flex: 1;
        font-size: var(--font-size-base);
        color: var(--color-text-primary);
      }

      .toggle-state {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        min-width: 60px;
      }

      .controls {
        display: flex;
        gap: 8px;
        margin-top: 16px;
      }

      .controls button {
        padding: 8px 16px;
        font-size: var(--font-size-sm);
        border: 1px solid var(--color-border);
        background: var(--color-background);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-fast);
      }

      .controls button:hover {
        background: var(--color-background-tertiary);
      }

      .log {
        margin-top: 16px;
        padding: 12px;
        background: var(--color-background);
        border-radius: var(--radius-md);
        font-family: monospace;
        font-size: var(--font-size-sm);
        max-height: 200px;
        overflow-y: auto;
      }

      .log-entry {
        margin-bottom: 4px;
        color: var(--color-text-secondary);
      }

      .log-entry.success {
        color: var(--color-success);
      }

      .log-entry.error {
        color: var(--color-error);
      }
    </style>
  </head>
  <body>
    <h1>ToggleSwitch Component Test</h1>

    <div class="test-section">
      <h2>1. Basic Toggle</h2>
      <p>기본 토글 스위치 - 클릭하여 상태 변경</p>
      <div class="toggle-row">
        <span class="toggle-label">Basic Toggle</span>
        <span class="toggle-state" id="basic-state">OFF</span>
        <div id="basic-toggle"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>2. Initially Enabled Toggle</h2>
      <p>초기 활성화 상태로 시작하는 토글</p>
      <div class="toggle-row">
        <span class="toggle-label">Enabled Toggle</span>
        <span class="toggle-state" id="enabled-state">ON</span>
        <div id="enabled-toggle"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>3. Disabled Toggle</h2>
      <p>비활성화된 토글 - 클릭해도 변경되지 않음</p>
      <div class="toggle-row">
        <span class="toggle-label">Disabled Toggle (ON)</span>
        <span class="toggle-state">ON</span>
        <div id="disabled-on-toggle"></div>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Disabled Toggle (OFF)</span>
        <span class="toggle-state">OFF</span>
        <div id="disabled-off-toggle"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>4. Programmatic Control</h2>
      <p>버튼을 통한 프로그래밍 방식 제어</p>
      <div class="toggle-row">
        <span class="toggle-label">Controlled Toggle</span>
        <span class="toggle-state" id="controlled-state">OFF</span>
        <div id="controlled-toggle"></div>
      </div>
      <div class="controls">
        <button id="btn-enable">Enable</button>
        <button id="btn-disable">Disable</button>
        <button id="btn-toggle">Toggle</button>
      </div>
    </div>

    <div class="test-section">
      <h2>5. Async Operation Simulation</h2>
      <p>비동기 작업 시뮬레이션 - 폰트 등록/해제</p>
      <div class="toggle-row">
        <span class="toggle-label">Font Toggle</span>
        <span class="toggle-state" id="font-state">OFF</span>
        <div id="font-toggle"></div>
      </div>
      <div class="log" id="font-log"></div>
    </div>

    <div class="test-section">
      <h2>6. Multiple Toggles</h2>
      <p>여러 토글 스위치 동시 표시</p>
      <div class="toggle-row">
        <span class="toggle-label">Font 1: Pretendard</span>
        <span class="toggle-state" id="multi-state-1">OFF</span>
        <div id="multi-toggle-1"></div>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Font 2: Noto Sans KR</span>
        <span class="toggle-state" id="multi-state-2">OFF</span>
        <div id="multi-toggle-2"></div>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Font 3: Spoqa Han Sans</span>
        <span class="toggle-state" id="multi-state-3">OFF</span>
        <div id="multi-toggle-3"></div>
      </div>
    </div>

    <script type="module">
      import { ToggleSwitch } from "./components/ToggleSwitch.js";

      // Helper function to update state display
      function updateStateDisplay(id, enabled) {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = enabled ? "ON" : "OFF";
          element.style.color = enabled
            ? "var(--color-success)"
            : "var(--color-text-secondary)";
        }
      }

      // Helper function to add log entry
      function addLog(message, type = "info") {
        const logContainer = document.getElementById("font-log");
        const entry = document.createElement("div");
        entry.className = `log-entry ${type}`;
        const timestamp = new Date().toLocaleTimeString();
        entry.textContent = `[${timestamp}] ${message}`;
        logContainer.appendChild(entry);
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      // 1. Basic Toggle
      const basicToggle = new ToggleSwitch({
        enabled: false,
        onChange: (enabled) => {
          console.log("Basic toggle:", enabled);
          updateStateDisplay("basic-state", enabled);
        },
      });
      basicToggle.mount(document.getElementById("basic-toggle"));

      // 2. Initially Enabled Toggle
      const enabledToggle = new ToggleSwitch({
        enabled: true,
        onChange: (enabled) => {
          console.log("Enabled toggle:", enabled);
          updateStateDisplay("enabled-state", enabled);
        },
      });
      enabledToggle.mount(document.getElementById("enabled-toggle"));

      // 3. Disabled Toggles
      const disabledOnToggle = new ToggleSwitch({
        enabled: true,
        disabled: true,
        onChange: (enabled) => {
          console.log("This should not be called");
        },
      });
      disabledOnToggle.mount(document.getElementById("disabled-on-toggle"));

      const disabledOffToggle = new ToggleSwitch({
        enabled: false,
        disabled: true,
        onChange: (enabled) => {
          console.log("This should not be called");
        },
      });
      disabledOffToggle.mount(document.getElementById("disabled-off-toggle"));

      // 4. Programmatic Control
      const controlledToggle = new ToggleSwitch({
        enabled: false,
        onChange: (enabled) => {
          console.log("Controlled toggle (user):", enabled);
          updateStateDisplay("controlled-state", enabled);
        },
      });
      controlledToggle.mount(document.getElementById("controlled-toggle"));

      document.getElementById("btn-enable").addEventListener("click", () => {
        console.log("Programmatically enabling...");
        controlledToggle.setEnabled(true);
        updateStateDisplay("controlled-state", true);
      });

      document.getElementById("btn-disable").addEventListener("click", () => {
        console.log("Programmatically disabling...");
        controlledToggle.setEnabled(false);
        updateStateDisplay("controlled-state", false);
      });

      document.getElementById("btn-toggle").addEventListener("click", () => {
        const currentState = controlledToggle.isEnabled();
        console.log("Toggling from", currentState, "to", !currentState);
        controlledToggle.setEnabled(!currentState);
        updateStateDisplay("controlled-state", !currentState);
      });

      // 5. Async Operation Simulation
      const fontToggle = new ToggleSwitch({
        enabled: false,
        onChange: async (enabled) => {
          const action = enabled ? "Registering" : "Unregistering";
          addLog(`${action} font...`, "info");

          // Disable toggle during operation
          fontToggle.setDisabled(true);

          try {
            // Simulate async operation
            await new Promise((resolve) => setTimeout(resolve, 1500));

            // Simulate 80% success rate
            if (Math.random() > 0.2) {
              addLog(
                `Font ${enabled ? "registered" : "unregistered"} successfully`,
                "success"
              );
              updateStateDisplay("font-state", enabled);
            } else {
              throw new Error("Operation failed");
            }
          } catch (error) {
            addLog(`Error: ${error.message}`, "error");
            // Rollback on error
            fontToggle.setEnabled(!enabled);
            updateStateDisplay("font-state", !enabled);
          } finally {
            // Re-enable toggle
            fontToggle.setDisabled(false);
          }
        },
      });
      fontToggle.mount(document.getElementById("font-toggle"));

      // 6. Multiple Toggles
      for (let i = 1; i <= 3; i++) {
        const toggle = new ToggleSwitch({
          enabled: false,
          onChange: (enabled) => {
            console.log(`Font ${i} toggle:`, enabled);
            updateStateDisplay(`multi-state-${i}`, enabled);
          },
        });
        toggle.mount(document.getElementById(`multi-toggle-${i}`));
      }

      console.log("ToggleSwitch test page loaded");
    </script>
  </body>
</html>
