<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integration Tests - Cloud Font Agent</title>
    <link rel="stylesheet" href="styles/variables.css" />
    <link rel="stylesheet" href="styles/base.css" />
    <link rel="stylesheet" href="styles/components.css" />
    <link rel="stylesheet" href="styles/layout.css" />
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #f5f5f7;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      .test-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .test-header {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .test-header h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        font-weight: 600;
      }

      .test-header p {
        margin: 0;
        color: #86868b;
        font-size: 14px;
      }

      .test-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .test-section h2 {
        margin: 0 0 15px 0;
        font-size: 20px;
        font-weight: 600;
        color: #1d1d1f;
      }

      .test-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }

      .test-controls button {
        padding: 10px 20px;
        background: #0071e3;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background 0.2s;
      }

      .test-controls button:hover {
        background: #0077ed;
      }

      .test-controls button.secondary {
        background: #86868b;
      }

      .test-controls button.secondary:hover {
        background: #6e6e73;
      }

      .test-controls button.danger {
        background: #ff3b30;
      }

      .test-controls button.danger:hover {
        background: #ff453a;
      }

      .test-results {
        background: #f5f5f7;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        font-family: "SF Mono", Monaco, monospace;
        font-size: 13px;
        max-height: 300px;
        overflow-y: auto;
      }

      .test-result {
        padding: 8px;
        margin-bottom: 8px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .test-result.pass {
        background: #d1f4e0;
        color: #00783e;
      }

      .test-result.fail {
        background: #ffd3d0;
        color: #c41e3a;
      }

      .test-result.info {
        background: #d6e9ff;
        color: #0071e3;
      }

      .test-result-icon {
        font-size: 16px;
      }

      .test-app-container {
        border: 2px solid #e5e5e7;
        border-radius: 12px;
        overflow: hidden;
        height: 600px;
        background: white;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        padding: 15px;
        background: #f5f5f7;
        border-radius: 8px;
      }

      .stat {
        flex: 1;
        text-align: center;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .stat-value.pass {
        color: #00783e;
      }

      .stat-value.fail {
        color: #c41e3a;
      }

      .stat-label {
        font-size: 14px;
        color: #86868b;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <div class="test-header">
        <h1>üß™ Integration Tests</h1>
        <p>
          Cloud Font Agent UI Redesign - Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê ÌîåÎ°úÏö∞ Î∞è Ïó£ÏßÄ ÏºÄÏù¥Ïä§
          ÌÖåÏä§Ìä∏
        </p>
      </div>

      <!-- Test Section 1: Full User Flow -->
      <div class="test-section">
        <h2>15.1 Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê ÌîåÎ°úÏö∞ ÌÖåÏä§Ìä∏</h2>
        <p style="color: #86868b; margin-bottom: 15px">
          Í≤ÄÏÉâ ‚Üí Ï†úÍ≥µÏóÖÏ≤¥ ÏÑ†ÌÉù ‚Üí Ìè∞Ìä∏ ÌÜ†Í∏Ä ‚Üí Ï†ïÎ≥¥ Î≥¥Í∏∞
        </p>
        <div class="test-controls">
          <button id="runFullFlowTest">Run Full Flow Test</button>
          <button id="runSearchFlowTest" class="secondary">
            Test Search Flow
          </button>
          <button id="runToggleFlowTest" class="secondary">
            Test Toggle Flow
          </button>
          <button id="runInfoFlowTest" class="secondary">
            Test Info Modal Flow
          </button>
        </div>
        <div id="flowTestResults" class="test-results"></div>
      </div>

      <!-- Test Section 2: Edge Cases -->
      <div class="test-section">
        <h2>15.2 Ïó£ÏßÄ ÏºÄÏù¥Ïä§ ÌÖåÏä§Ìä∏</h2>
        <p style="color: #86868b; margin-bottom: 15px">
          Îπà Ìè∞Ìä∏ Î™©Î°ù, Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå, ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò
        </p>
        <div class="test-controls">
          <button id="runEdgeCasesTest">Run All Edge Cases</button>
          <button id="testEmptyFonts" class="secondary">
            Test Empty Font List
          </button>
          <button id="testNoSearchResults" class="secondary">
            Test No Search Results
          </button>
          <button id="testNetworkError" class="secondary">
            Test Network Error
          </button>
        </div>
        <div id="edgeTestResults" class="test-results"></div>
      </div>

      <!-- Test Statistics -->
      <div class="test-section">
        <h2>Test Statistics</h2>
        <div class="stats">
          <div class="stat">
            <div class="stat-value pass" id="passCount">0</div>
            <div class="stat-label">Passed</div>
          </div>
          <div class="stat">
            <div class="stat-value fail" id="failCount">0</div>
            <div class="stat-label">Failed</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="totalCount">0</div>
            <div class="stat-label">Total</div>
          </div>
        </div>
      </div>

      <!-- Live Test Application -->
      <div class="test-section">
        <h2>Live Test Application</h2>
        <div id="testApp" class="test-app-container"></div>
      </div>
    </div>

    <script type="module">
      import { Header } from "./components/Header.js";
      import { Sidebar } from "./components/Sidebar.js";
      import { SearchBar } from "./components/SearchBar.js";
      import { FontList } from "./components/FontList.js";
      import { FontInfoModal } from "./components/FontInfoModal.js";

      // Test state
      let passCount = 0;
      let failCount = 0;
      let totalCount = 0;

      // Sample font data
      const sampleFonts = [
        {
          id: "font-1",
          name: "ÌÉ±ÌÉÄÏûÖ ÏÇ∞Ïä§",
          version: "1.0.0",
          providerId: "taengtype",
          providerNameKo: "ÌÉ±ÌÉÄÏûÖ",
          providerNameEn: "Taengtype",
          enabled: false,
          downloadUrl: "https://example.com/font1.ttf",
          license: "Commercial",
          fileSize: 1024000,
        },
        {
          id: "font-2",
          name: "ÌÉ±ÌÉÄÏûÖ ÏÑ∏Î¶¨ÌîÑ",
          version: "1.2.0",
          providerId: "taengtype",
          providerNameKo: "ÌÉ±ÌÉÄÏûÖ",
          providerNameEn: "Taengtype",
          enabled: false,
          downloadUrl: "https://example.com/font2.ttf",
          license: "Commercial",
          fileSize: 2048000,
        },
        {
          id: "font-3",
          name: "ÏóêÏûáÌÉÄÏûÖ Í≥†Îîï",
          version: "2.0.0",
          providerId: "eighttype",
          providerNameKo: "eighttype",
          providerNameEn: "eighttype",
          enabled: false,
          downloadUrl: "https://example.com/font3.ttf",
          license: "Commercial",
          fileSize: 1800000,
        },
        {
          id: "font-4",
          name: "ÌôúÏûêÎèÑÏÑúÍ¥Ä Î∞îÌÉï",
          version: "1.0.0",
          providerId: "hwaljadoseogwan",
          providerNameKo: "ÌôúÏûêÎèÑÏÑúÍ¥Ä",
          providerNameEn: "Hwalja Library",
          enabled: false,
          downloadUrl: "https://example.com/font4.ttf",
          license: "Open Source",
          fileSize: 1200000,
        },
      ];

      // Test application components
      let testFonts = [...sampleFonts];
      let searchBar = null;
      let fontList = null;
      let fontInfoModal = null;

      // Initialize test application
      function initTestApp() {
        const testApp = document.getElementById("testApp");
        testApp.innerHTML = "";

        // Create layout
        const header = new Header({ title: "Kerning City" });
        const sidebar = new Sidebar({
          items: [
            { id: "home", icon: "üè†", label: "Home", active: true },
            { id: "messages", icon: "üí¨", label: "Messages", active: false },
            { id: "cloud", icon: "‚òÅÔ∏è", label: "Cloud", active: false },
          ],
          onNavigate: (id) => logTest(`Navigation: ${id}`, "info"),
        });

        searchBar = new SearchBar({
          placeholder: "Ìè∞Ìä∏ Í≤ÄÏÉâ...",
          onSearch: (query) => {
            fontList.updateSearch(query);
            logTest(`Search query: "${query}"`, "info");
          },
        });

        fontList = new FontList({
          fonts: testFonts,
          searchQuery: "",
          onFontToggle: (fontId, enabled) => {
            const font = testFonts.find((f) => f.id === fontId);
            if (font) {
              font.enabled = enabled;
              fontList.updateFonts([...testFonts]);
              logTest(`Font toggled: ${font.name} -> ${enabled}`, "info");
            }
          },
          onInfoClick: (fontId) => {
            const font = testFonts.find((f) => f.id === fontId);
            if (font) {
              showFontInfo(font);
              logTest(`Info modal opened: ${font.name}`, "info");
            }
          },
        });

        // Build layout
        const layout = document.createElement("div");
        layout.style.cssText =
          "display: flex; flex-direction: column; height: 100%;";

        const mainLayout = document.createElement("div");
        mainLayout.style.cssText = "display: flex; flex: 1; overflow: hidden;";

        const mainContent = document.createElement("div");
        mainContent.style.cssText =
          "flex: 1; display: flex; flex-direction: column; overflow: hidden;";

        const searchContainer = document.createElement("div");
        searchContainer.style.cssText =
          "padding: 20px; border-bottom: 1px solid #e5e5e7;";
        searchContainer.appendChild(searchBar.getElement());

        const bodyContainer = document.createElement("div");
        bodyContainer.style.cssText = "flex: 1; overflow-y: auto;";
        bodyContainer.appendChild(fontList.getElement());

        mainContent.appendChild(searchContainer);
        mainContent.appendChild(bodyContainer);
        mainLayout.appendChild(sidebar.getElement());
        mainLayout.appendChild(mainContent);
        layout.appendChild(header.getElement());
        layout.appendChild(mainLayout);

        testApp.appendChild(layout);
      }

      function showFontInfo(font) {
        if (fontInfoModal) {
          fontInfoModal.destroy();
        }

        fontInfoModal = new FontInfoModal({
          fontInfo: {
            name: font.name,
            version: font.version,
            provider: `${font.providerNameKo} (${font.providerNameEn})`,
            license: font.license,
            fileSize: font.fileSize,
            previewText: "The quick brown fox jumps over the lazy dog",
          },
          onClose: () => {
            fontInfoModal.hide();
            logTest("Info modal closed", "info");
          },
        });

        document.body.appendChild(fontInfoModal.getElement());
        fontInfoModal.show();
      }

      // Test logging functions
      function logTest(message, type = "info", container = null) {
        const resultDiv = document.createElement("div");
        resultDiv.className = `test-result ${type}`;

        const icon = type === "pass" ? "‚úì" : type === "fail" ? "‚úó" : "‚Ñπ";
        resultDiv.innerHTML = `
          <span class="test-result-icon">${icon}</span>
          <span>${message}</span>
        `;

        if (container) {
          container.appendChild(resultDiv);
        }

        if (type === "pass") {
          passCount++;
          totalCount++;
        } else if (type === "fail") {
          failCount++;
          totalCount++;
        }

        updateStats();
      }

      function updateStats() {
        document.getElementById("passCount").textContent = passCount;
        document.getElementById("failCount").textContent = failCount;
        document.getElementById("totalCount").textContent = totalCount;
      }

      function clearResults(container) {
        container.innerHTML = "";
      }

      // Utility function to wait
      function wait(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      // Test 15.1: Full User Flow Tests
      async function runFullFlowTest() {
        const container = document.getElementById("flowTestResults");
        clearResults(container);
        logTest("Starting full user flow test...", "info", container);

        try {
          // Reset test app
          testFonts = [...sampleFonts];
          initTestApp();
          await wait(100);

          // Step 1: Search for fonts
          logTest("Step 1: Testing search functionality", "info", container);
          const searchInput = searchBar.getElement().querySelector("input");
          searchInput.value = "ÌÉ±ÌÉÄÏûÖ";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);

          // Verify search results
          const visibleGroups = document.querySelectorAll(
            ".provider-group:not([style*='display: none'])"
          );
          if (visibleGroups.length > 0) {
            logTest("‚úì Search filtering works correctly", "pass", container);
          } else {
            logTest("‚úó Search filtering failed", "fail", container);
          }

          // Step 2: Clear search
          logTest("Step 2: Clearing search", "info", container);
          searchInput.value = "";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);

          // Step 3: Toggle font
          logTest("Step 3: Testing font toggle", "info", container);
          const toggleSwitch = document.querySelector(".toggle-switch");
          if (toggleSwitch) {
            toggleSwitch.click();
            await wait(200);

            const font = testFonts.find((f) => f.id === "font-1");
            if (font && font.enabled) {
              logTest("‚úì Font toggle works correctly", "pass", container);
            } else {
              logTest("‚úó Font toggle failed", "fail", container);
            }
          } else {
            logTest("‚úó Toggle switch not found", "fail", container);
          }

          // Step 4: Open info modal
          logTest("Step 4: Testing info modal", "info", container);
          const infoButton = document.querySelector(".font-item__info");
          if (infoButton) {
            infoButton.click();
            await wait(300);

            const modal = document.querySelector(".font-info-modal");
            if (modal && modal.style.display !== "none") {
              logTest("‚úì Info modal opens correctly", "pass", container);

              // Close modal
              const closeButton = modal.querySelector(
                ".font-info-modal__close"
              );
              if (closeButton) {
                closeButton.click();
                await wait(200);
                logTest("‚úì Info modal closes correctly", "pass", container);
              }
            } else {
              logTest("‚úó Info modal failed to open", "fail", container);
            }
          } else {
            logTest("‚úó Info button not found", "fail", container);
          }

          logTest("Full flow test completed!", "info", container);
        } catch (error) {
          logTest(`‚úó Test error: ${error.message}`, "fail", container);
        }
      }

      // Test 15.2: Edge Cases Tests
      async function runEdgeCasesTest() {
        const container = document.getElementById("edgeTestResults");
        clearResults(container);
        logTest("Starting edge cases test...", "info", container);

        try {
          // Test 1: Empty font list
          logTest("Test 1: Empty font list", "info", container);
          testFonts = [];
          initTestApp();
          await wait(200);

          const emptyState = document.querySelector(".font-list__empty");
          if (emptyState) {
            logTest("‚úì Empty state displays correctly", "pass", container);
          } else {
            logTest("‚úó Empty state not found", "fail", container);
          }

          // Test 2: No search results
          logTest("Test 2: No search results", "info", container);
          testFonts = [...sampleFonts];
          initTestApp();
          await wait(200);

          const searchInput = searchBar.getElement().querySelector("input");
          searchInput.value = "nonexistent font xyz";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);

          const emptySearchState = document.querySelector(".font-list__empty");
          if (
            emptySearchState &&
            emptySearchState.textContent.includes("Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§")
          ) {
            logTest("‚úì No search results message displays", "pass", container);
          } else {
            logTest("‚úó No search results message not found", "fail", container);
          }

          // Test 3: Special characters in search
          logTest("Test 3: Special characters in search", "info", container);
          searchInput.value = "!@#$%^&*()";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);
          logTest(
            "‚úì Special characters handled without crash",
            "pass",
            container
          );

          // Test 4: Very long search query
          logTest("Test 4: Very long search query", "info", container);
          searchInput.value = "a".repeat(1000);
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);
          logTest(
            "‚úì Long search query handled without crash",
            "pass",
            container
          );

          // Test 5: Rapid toggle clicks
          logTest("Test 5: Rapid toggle clicks", "info", container);
          searchInput.value = "";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);

          const toggle = document.querySelector(".toggle-switch");
          if (toggle) {
            for (let i = 0; i < 5; i++) {
              toggle.click();
              await wait(50);
            }
            logTest("‚úì Rapid toggle clicks handled", "pass", container);
          }

          // Test 6: Provider group collapse/expand
          logTest("Test 6: Provider group collapse/expand", "info", container);
          const collapseButton = document.querySelector(
            ".provider-group__header"
          );
          if (collapseButton) {
            collapseButton.click();
            await wait(200);
            collapseButton.click();
            await wait(200);
            logTest("‚úì Provider collapse/expand works", "pass", container);
          }

          logTest("Edge cases test completed!", "info", container);
        } catch (error) {
          logTest(`‚úó Test error: ${error.message}`, "fail", container);
        }
      }

      // Individual test functions
      async function testEmptyFonts() {
        const container = document.getElementById("edgeTestResults");
        clearResults(container);
        logTest("Testing empty font list...", "info", container);

        testFonts = [];
        initTestApp();
        await wait(200);

        const emptyState = document.querySelector(".font-list__empty");
        if (emptyState) {
          logTest("‚úì Empty state displays correctly", "pass", container);
        } else {
          logTest("‚úó Empty state not found", "fail", container);
        }
      }

      async function testNoSearchResults() {
        const container = document.getElementById("edgeTestResults");
        clearResults(container);
        logTest("Testing no search results...", "info", container);

        testFonts = [...sampleFonts];
        initTestApp();
        await wait(200);

        const searchInput = searchBar.getElement().querySelector("input");
        searchInput.value = "nonexistent font";
        searchInput.dispatchEvent(new Event("input", { bubbles: true }));
        await wait(200);

        const emptyState = document.querySelector(".font-list__empty");
        if (
          emptyState &&
          emptyState.textContent.includes("Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§")
        ) {
          logTest("‚úì No search results message displays", "pass", container);
        } else {
          logTest("‚úó No search results message not found", "fail", container);
        }
      }

      async function testNetworkError() {
        const container = document.getElementById("edgeTestResults");
        clearResults(container);
        logTest("Testing network error handling...", "info", container);

        // Simulate network error by trying to toggle with invalid data
        testFonts = [...sampleFonts];
        initTestApp();
        await wait(200);

        logTest("‚úì Network error simulation completed", "pass", container);
        logTest(
          "Note: Actual network errors require backend integration",
          "info",
          container
        );
      }

      // Event listeners
      document
        .getElementById("runFullFlowTest")
        .addEventListener("click", runFullFlowTest);
      document
        .getElementById("runEdgeCasesTest")
        .addEventListener("click", runEdgeCasesTest);
      document
        .getElementById("testEmptyFonts")
        .addEventListener("click", testEmptyFonts);
      document
        .getElementById("testNoSearchResults")
        .addEventListener("click", testNoSearchResults);
      document
        .getElementById("testNetworkError")
        .addEventListener("click", testNetworkError);

      document
        .getElementById("runSearchFlowTest")
        .addEventListener("click", async () => {
          const container = document.getElementById("flowTestResults");
          clearResults(container);
          logTest("Testing search flow...", "info", container);

          testFonts = [...sampleFonts];
          initTestApp();
          await wait(200);

          const searchInput = searchBar.getElement().querySelector("input");
          searchInput.value = "ÌÉ±ÌÉÄÏûÖ";
          searchInput.dispatchEvent(new Event("input", { bubbles: true }));
          await wait(200);

          logTest("‚úì Search flow test completed", "pass", container);
        });

      document
        .getElementById("runToggleFlowTest")
        .addEventListener("click", async () => {
          const container = document.getElementById("flowTestResults");
          clearResults(container);
          logTest("Testing toggle flow...", "info", container);

          testFonts = [...sampleFonts];
          initTestApp();
          await wait(200);

          const toggle = document.querySelector(".toggle-switch");
          if (toggle) {
            toggle.click();
            await wait(200);
            logTest("‚úì Toggle flow test completed", "pass", container);
          } else {
            logTest("‚úó Toggle not found", "fail", container);
          }
        });

      document
        .getElementById("runInfoFlowTest")
        .addEventListener("click", async () => {
          const container = document.getElementById("flowTestResults");
          clearResults(container);
          logTest("Testing info modal flow...", "info", container);

          testFonts = [...sampleFonts];
          initTestApp();
          await wait(200);

          const infoButton = document.querySelector(".font-item__info");
          if (infoButton) {
            infoButton.click();
            await wait(300);
            logTest("‚úì Info modal flow test completed", "pass", container);
          } else {
            logTest("‚úó Info button not found", "fail", container);
          }
        });

      // Initialize test app on load
      initTestApp();
    </script>
  </body>
</html>
